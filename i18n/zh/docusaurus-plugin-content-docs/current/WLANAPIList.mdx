import ImageZoom from "@site/src/components/ImageZoom";
import WLANMessage from "@site/static/img/WLANMessage.png";
import WLANMessage2 from "@site/static/img/WLANMessage2.png";


# WLAN/LAN mode API list

## Communication protocol

CodePay Register uses the <a href = "https://en.wikipedia.org/wiki/WebSocket">WebSocket</a> protocol to implement the server side. WebSocket is a technology used for arbitrary two-way data transfer between the client and the server. The WebSocket protocol is implemented based on the TCP protocol and consists of an initial handshake and subsequent two-way transfer of multiple data frames. Its purpose is in the WebSocket client and WebSocket server for frequent two-way communication, can make the server to avoid opening multiple HTTP connections to work to save resources, improve the efficiency and resource utilization.

## Message structure

### Field format

POS application and CodePay Register communicate in `JSON` format

### Common data

Different aspects of each field are defined in this document according to the following conventions.
- M: Required parameters
- C: Required parameters when some conditions are met
- O: Optional parameters
- -: Not Present
The common parameters is as follows:

| Key    \ width:20% \ | Parameter type \ width:10% \ | Request \ width:10% \ | Response \ width:10% \ | Description   \ width:50% \                                                                                                                                                                                                                 |
|----------------------|------------------------------|-----------------------|------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| topic                | string                       | M                     | M                      | Message topic identifier. Please refer to the topic Example: ecrhub.pay.order                                                                                                                                                               |
| request_id           | string                       | M                     | M                      | Transaction Request ID, used to receive the corresponding response. The caller needs to remain unique.                                                                                                                                      |
| timestamp            | string                       | O                     | O                      | Timestamp Example: 1698302992263                                                                                                                                                                                                            |
| version              | string                       | O                     | O                      | The API version. fixed value:1.0 Example: 1.0                                                                                                                                                                                               |
| app_id               | string                       | M                     | M                      | The payment app id registered in Codepay Gateway, Please refer to the <a href = "/GatewayOverview" target = "_blank">Payment gateway integration guide</a>                                                                                  |
| biz_data             | JSONObject                   | M                     | M                      | Business Data. each transaction type has own business data                                                                                                                                                                                  |
| response_code        | string                       | -                     | M                      | The order payment status code returned by CodePay Register, 000 means the transaction was successful, other means the transaction failed.Please refer to <a href = "PosIntegratesrReference#5-response-code">Response code</a> <br /><br /> |
| response_msg         | String                       | -                     | C                      | Failed transaction error message returned by CodePay Register                                                                                                                                                                               |


### Input parameter structure diagram

<ImageZoom src={WLANMessage} />

### Output parameter structure diagram

<ImageZoom src={WLANMessage2} />

## Topic

Each transaction type has a message topic:

| Key  \ width:50%; \ | Name  \ width:50%; \ |
|:--------------------|:---------------------|
| ecrhub.pay.order    | Submit transaction   |
| ecrhub.pay.query    | Query transaction    |
| ecrhub.pay.close    | Close transaction    |

## Transaction message

### 1. Submit transaction

**Message Topic**

`ecrhub.pay.order`

**Parameter list**

| Name  \ width:20%; \             | Type  \ width:10%; \ | Request \ width:10%; \ | Response \ width:10%; \ | Description   \ width:50%; \                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|:---------------------------------|:---------------------|:-----------------------|:------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| trans_type                       | String               | M                      | M                       | Transaction type. Please refer to <a href = "PosIntegratesrReference#3-transaction-type" target = "_blank">Transaction type</a> <br /> <br /> <font color = "green">Example: 1</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| merchant_order_no                | String               | M                      | M                       | Merchant order number.This field represents the order number for the refund request when refunded, different from the order number of the original consumer transaction. No more than 32 alphanumeric characters. <br /> <br /> <font color = "green">Example: 121775014073233018 </font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| orig_merchant_order_no           | String               | C                      | C                       | Original merchant order number. If the transaction type is Void, Refund, Completion, it must be required. (trans_type = 2,3,6) <br /> <br /> <font color = "green">Example: 121775014073233368018</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| price_currency                   | String               | O                      | O                       | Price Currency, compliant with ISO-4217 standard, described with a three-character code  <br /> <br /> <font color = "green">Example：USD</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| order_amount                     | String               | M                      | M                       | Order amount.  This field represents the transaction ordered amount,   For example, one USD stands for one dollar, not one cent. <br /> <br /> <font color = "green">Example: 34.50</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| tip_amount                       | String               | O                      | O                       | Tip amount. This field represents the transaction tip amount. For example, 1 USD stands for one dollar, not one cent. <br /> <br /> <font color = "green">Example: 34.50</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| on_screen_tip                    | boolean              | O                      | O                       | Whether or not to enter tips on the CodePay Register page, default is false, when "trans_type=1, 3, 4", this parameter can be set <br /><br /> <font color = "green">Example: true</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| cashback_amount                  | String               | O                      | O                       | Cashback amount. Expressed in the quoted currency, for example, One USD stands for one dollar, not one cent <br /> <br /> <font color = "green">Example: 10.00</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| pay_method_id                    | String               | O                      | O                       | Payment method id. Please Refer to <a href = "PosIntegratesrReference#2-payment-method" target = "_blank">Payment method</a> <br /><br /> If the TransType is 3, this parameter will not required <br /> <br /> <font color = "green">Example:Visa</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| pay_scenario                     | String               | O                      | O                       | Payment scene, please refer to <a href = "PosIntegratesrReference#1-payment-scenario" target = "_blank">PayScenario </a> <br /> <br /> <font color = "green">Example: SWIPE_CARD</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| card_type                        | String               | O                      | O                       | Type of bank card,please refer to <a href = "PosIntegratesrReference#6-card-type" target = "_blank">Card type</a>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| attach                           | String               | O                      | O                       | Additional data.Allows merchants to submit additional data, which will be returned as is. <br /> <br /> <font color = "green">Example: abc123</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| description                      | String               | O                      | O                       | Description of ordered goods or services.A brief description of the goods or services purchased by the customer. <br /> <br /> <font color = "green">Example: IPhone White X2</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| notify_url                       | String               | O                      | O                       | Callback address for payment notification.Receive payment notifications from the CodePay gateway to call back the server address, and only when the transaction goes through the Codepay payment gateway will there be a callback. <br /> <br /> <font color = "green">Example: http://www.abc.com/callback?id=12345</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| expires                          | String               | O                      | O                       | Order expires time, after the expires time is not allowed to be paid, unit: seconds <br /> <br /> <font color = "green">Example: 180</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| confirm_on_terminal              | boolean              | O                      | O                       | Do you need terminal confirmation before proceeding with payment operations? The default is false. When set to true, you need to confirm the order first, otherwise you will directly enter the card reading interface                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| required_terminal_authentication | boolean              | O                      | O                       | When refund or void a transaction, does the store manager role need to authorize this operation on the terminal? default value: false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| on_screen_signature              | boolean              | O                      | O                       | This parameter controls the display logic of electronic signatures: <br /><ul><li>true: Display the electronic signature page and print the signature information on the purchase order</li><li>false: The electronic signature page will not be displayed, but the signature area needs to be printed on the purchase order</li></ul>  <font color="red">But even if this parameter is set, CodePay Register still processes electronic signatures according to the following logic in the following situations:</font> <br /> <ul><li> Credit card network, APP does not display signature page, fixed on receipt to print signature column</li> <br /> <li>Pin debit transactions do not require a signature, the APP does not display a signature page, and the receipt is not printed either</li></ul> |
| trans_no                         | String               | -                      | M                       | Transaction number of Codepay. which uniquely identifies a transaction. <br /> <br /> <font color = "green">Example: 5021000010210602000003</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| trans_status                     | String               | -                      | M                       | Transaction status, please refer to <a href = "PosIntegratesrReference#4-transaction-status">Transaction status</a>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| pay_channel_trans_no             | String               | -                      | O                       | Payment channel transaction serial number, If trans_status is <font color = "red">2</font>, the returned data will include this parameters, such as Visa, Mastercard and other payment platforms. <br /> <br /> <font color = "green">Example: 000000123</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| discount_bmopc                   | string               | -                      | O                       | Payment channel merchant discount amount, If trans_status is <font color = "red">2</font>, the returned data will include this parameters, The merchant gives the customer a preferential amount through the payment channel, and this part of the payment channel will not be settled to the merchant. <br /><br /> <font color = "green">Example: 3.00</font>                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| discount_bpc                     | string               | -                      | O                       | Payment channel discount amount,If trans_status is <font color = "red">2</font>, the returned data will include this parameters. Discount the amount of the payment channel to the customer, and this part of the funds will be settled into the merchant account. <br /><br /> <font color = "green">Example: 5.00</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| trans_end_time                   | string               | -                      | O                       | Transaction completed time. If trans_status is <font color = "red">2</font>, the returned data will include this parameters. Timezone: Local time zone, the time zone set by the payment terminal,  Format: YYYY-MM-DD HH:mm:ss <br /><br /> <font color = "green">Example: 2021-06-03 12:48:51</font>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

### 2. Query transaction

**Message Topic**

`ecrhub.pay.query`

**Parameter list**

| Name  \ width:20%; \ | Type  \ width:10%; \ | Request \ width:10%; \ | Response \ width:10%; \ | Description   \ width:50%; \                                                                                                                                                                                                                                                                                                                                            |
|:---------------------|:---------------------|:-----------------------|:------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| merchant_order_no    | String               | M                      | M                       | Merchant order number.This field represents the order number for the refund request when refunded, different from the order number of the original consumer transaction. No more than 32 alphanumeric characters. <br /> <br /> <font color = "green">Example: 121775014073233018 </font>                                                                               |
| trans_type           | String               | -                      | M                       | Transaction type. Please refer to <a href = "PosIntegratesrReference#3-transaction-type" target = "_blank">Transaction type</a> <br /> <br /> <font color = "green">Example: 1</font>                                                                                                                                                                                   |
| price_currency       | String               | -                      | M                       | Price Currency, compliant with ISO-4217 standard, described with a three-character code  <br /> <br /> <font color = "green">Example：USD</font>                                                                                                                                                                                                                         |
| order_amount         | String               | -                      | M                       | Order amount.  This field represents the transaction ordered amount,   For example, one USD stands for one dollar, not one cent. <br /> <br /> <font color = "green">Example: 34.50</font>                                                                                                                                                                              |
| tip_amount           | String               | -                      | O                       | Tip amount. This field represents the transaction tip amount. For example, 1 USD stands for one dollar, not one cent. <br /> <br /> <font color = "green">Example: 34.50</font>                                                                                                                                                                                         |
| cashback_amount      | String               | -                      | O                       | Cashback amount. Expressed in the quoted currency, for example, One USD stands for one dollar, not one cent <br /> <br /> <font color = "green">Example: 10.00</font>                                                                                                                                                                                                   |
| attach               | String               | -                      | O                       | Additional data.Allows merchants to submit additional data, which will be returned as is. <br /> <br /> <font color = "green">Example: abc123</font>                                                                                                                                                                                                                    |
| trans_no             | String               | -                      | M                       | Transaction number of Codepay. which uniquely identifies a transaction. <br /> <br /> <font color = "green">Example: 5021000010210602000003</font>                                                                                                                                                                                                                      |
| trans_status         | String               | -                      | M                       | Transaction status, please refer to <a href = "PosIntegratesrReference#4-transaction-status">Transaction status</a>                                                                                                                                                                                                                                                     |
| pay_scenario         | String               | -                      | O                       | Payment scene, If trans_status is <font color = "red">2</font>, the returned data will include the following parameters, please refer to Please Refer to <a href = "PosIntegratesrReference#1-payment-scenario" target = "_blank">PayScenario </a> <br /> <br /> <font color = "green">Example: SWIPE_CARD</font>                                                       |
| pay_method_id        | String               | -                      | O                       | Payment method id. If trans_status is <font color = "red">2</font>, the returned data will include the following parameters. Please Refer to <a href = "PosIntegratesrReference#2-payment-method" target = "_blank">Payment method</a> <br /><br /> If the TransType is 3, this parameter will not required <br /> <br /> <font color = "green">Example:Visa</font>     |
| pay_channel_trans_no | String               | -                      | O                       | Payment channel transaction serial number, If trans_status is <font color = "red">2</font>, the returned data will include the following parameters, such as Visa, Mastercard and other payment platforms. <br /> <br /> <font color = "green">Example: 000000123</font>                                                                                                |
| discount_bmopc       | string               | -                      | O                       | Payment channel merchant discount amount,If trans_status is <font color = "red">2</font>, the returned data will include the following parameters. The merchant gives the customer a preferential amount through the payment channel, and this part of the payment channel will not be settled to the merchant. <br /><br /> <font color = "green">Example: 3.00</font> |
| discount_bpc         | string               | -                      | O                       | Payment channel discount amount, If trans_status is <font color = "red">2</font>, the returned data will include the following parameters. Discount the amount of the payment channel to the customer, and this part of the funds will be settled into the merchant account. <br /><br /> <font color = "green">Example: 5.00</font>                                    |
| trans_end_time       | string               | -                      | O                       | Transaction completed time. If trans_status is <font color = "red">2</font>, the returned data will include the following parameters. Timezone: Local time zone, the time zone set by the payment terminal,  Format: YYYY-MM-DD HH:mm:ss <br /><br /> <font color = "green">Example: 2021-06-03 12:48:51</font>                                                         |


### 3. Close transaction

**Message Topic**

`ecrhub.pay.close`

**Parameter list**

| Name  \ width:20%; \ | Type  \ width:10%; \ | Request \ width:10%; \ | Response \ width:10%; \ | Description   \ width:50%; \                                                                                                                                                                                                                                                              |
|:---------------------|:---------------------|:-----------------------|:------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| merchant_order_no    | String               | M                      | M                       | Merchant order number.This field represents the order number for the refund request when refunded, different from the order number of the original consumer transaction. No more than 32 alphanumeric characters. <br /> <br /> <font color = "green">Example: 121775014073233018 </font> |
